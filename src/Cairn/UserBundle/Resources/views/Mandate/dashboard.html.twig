{# src/Cairn/UserBundle/Resources/views/Mandate/dashboard.html.twig #}         
                                                                               
{% extends "CairnUserBundle::layout.html.twig" %}                        
                                                                               
{% block title %}{% endblock %}                                                                 
                                                                               
{%block stylesheets %}
{% endblock %}

{% block body %}

<div class="row">
    <h2> Les mandats </h2>
    <ul class="collapsible">
        <li>
            <div class="collapsible-header"><i class="material-icons">sort</i>Filtres</div>
            <div class="collapsible-body">
                {{ form_start(form) }}
                <div class="row">
                    <div class="col s12 m6 l3">
                        {{ form_label(form.status) }}
                        {{ form_widget(form.status) }}
                    </div>
                    <div class="col s12 l6">
                        {{form_row(form.cairn_user, {'attr': {'class': 'form_search_user'}} ) }}
                    </div>

                    {{ form_rest(form) }}
                </div>

                {{form_end(form) }}
            </div>
        </li>
    </ul>

    {% for mandate in mandates %}
        {% set status = mandate.status %}


      <div class="col s12 m6 l4">
        <div class="card blue-grey darken-1">
            <div class="card-content white-text">
                <span class="card-title center">{{mandate.contractor.name}}</span>
                <p>
                    début : {{mandate.beginAt|date('d-m-Y')}} 
                    <br>
                    fin : {{mandate.endAt|date('d-m-Y')}} 
                    <br>
                    montant : {{mandate.amount}}
                    <br>
                    statut :
                    {% if status ==  constant('Cairn\\UserBundle\\Entity\\Mandate::CANCELED')%}
                        <i class="material-icons">clear</i>
                    {% elseif status == constant('Cairn\\UserBundle\\Entity\\Mandate::UP_TO_DATE')%}
                        <i class="material-icons">done</i>
                    {% elseif status ==  constant('Cairn\\UserBundle\\Entity\\Mandate::COMPLETE')%}
                        <i class="material-icons">done_all</i>
                    {% elseif status == constant('Cairn\\UserBundle\\Entity\\Mandate::SCHEDULED') %}
                        <i class="material-icons">schedule</i>
                    {% endif %}
                </p>
            </div>
            {% if status == constant('Cairn\\UserBundle\\Entity\\Mandate::OVERDUE') %}

                <div class="card-action center">
                    <a href="{{path('cairn_user_mandates_honour', {'id': mandate.id})}}"> Honorer</a>
                </div>

            {% elseif (status == constant('Cairn\\UserBundle\\Entity\\Mandate::UP_TO_DATE')) or (status == constant('Cairn\\UserBundle\\Entity\\Mandate::SCHEDULED')) %}
                <div class="card-action center">
                    <a href="{{path('cairn_user_mandates_cancel', {'id': mandate.id})}}"> Révoquer</a>
                </div>

            {% endif %}

            
        </div>
      </div>
    {% else %}  
        Aucun mandat ne correspond à votre recherche !
    {% endfor %}

</div>
{% endblock %}              

{% block javascripts %}
    <script>
        $(function (){
            jQuery.ajax({
                type: 'POST',
                url: "{{ path('cairn_accounts_ajax') }}",
                dataType: 'json',
                success: function (response) {
                    var accounts = response;
                    var data = {};
                    for (var i = 0; i < accounts.length; i++) {
                        data[accounts[i].name] = null;
                    }
                    console.log();

                    $("#form_cairn_user").autocomplete({
                        data: data,
                        limit: 6, // The max amount of results that can be shown at once. Default: Infinity.
                    });
                }, 
            });
        });

    </script>

{% endblock %}


